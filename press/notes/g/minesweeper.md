---
date: 2023/3/1
title: 扫雷
category: 练习
tags:
  - 小游戏
---

某天我在刷 B 站时看到了 [antfu](https://antfu.me/) 用 vue 写扫雷的 [直播回放](https://www.bilibili.com/video/BV1ia411b7jY/)，深受启发，觉得很有意思，当时就想着自己也做一个试试。于是乎经过一段漫长的实践，我终于做出了一版 😀。

## 试玩

## 日志

在“遥远”的 win 98 时代，扫雷就已经是家喻户晓的小游戏了。而现在，我在网络上还时不时看到这样一个段子 —— “你这个配置，能流畅运行扫雷吗”😆。  
关于扫雷的具体规则可以查看本文最后的参考链接，我这里不再赘述，就先简单罗列下游戏的操作说明：

| 鼠标 | 未翻开的格子               | 已翻开的格子                                                             |
| ---- | -------------------------- | ------------------------------------------------------------------------ |
| 单击 | 有标雷就取消标雷，否则翻开 | 高亮周围(共 8 个格子)还未翻开的格子                                      |
| 右击 | 切换 标雷/取消标雷         | 高亮周围还未翻开的格子                                                   |
| 双击 | 高亮自身                   | 如果有数字且与该数字周围已标雷的数量相等，那么会翻开周围所有未标雷的格子 |

另外，为了方便移动端的触屏操作，我还加了两个选项（不过感觉还是不如 pc 端玩起来顺手）：

- `✅ 🚀`：勾选后，点击已翻开的格子时，可以模拟双击效果
- `✅ 🚩`：勾选后，点击未翻开的格子时，可以模拟右击效果（即切换 标雷/取消标雷）

### 开局布雷算法

如何将 N 个雷均匀放置在 `W * H` 的地图上？ 这是我遇到的第一个算法难点。

我们当然很容易想到：将地图块预先编号，然后进行不放回抽样，连取 N 次后，得到的所有编号就是应该布雷的区域。这种做法使得我们可以保证雷是随机分布在各个小块中的。但它的游戏体验好吗？

玩家可能会在翻开第一块后就 GG 了，这样的话就有点太靠玩家运气。很容易想到，我们可以等玩家翻开第一块后，再执行随机布雷的算法（预先排除这一块），从而避免出现开局就炸的极端情况。这也是我目前的做法。

但多玩几次后，我发现这种做法还是有点问题的（让游戏通关太过靠运气），特别是在高级难度中（地图上地雷密度变大），很容易开局连续翻开几块都没有触发“自动展开逻辑”，从而局面上看玩家还是得靠运气，也许翻开下一块就 GG 了。

所以个人觉得好点的布雷算法，应该是在确保给到玩家一个良好的“局面”后，再让玩家有可能翻到雷。不过很遗憾，我目前没有做到这一步。

### 自动展开逻辑

这个可以看作是游戏中的额外奖赏机制：当你翻开一块雷，且周围区域都不是雷时（可以简单理解为这个数字应该展示 0），就会触发该奖赏：自动翻开周围所有小格，从而帮玩家节省操作时间。

由于当系统自动翻开周围所有小格时，如果其中有小格也满足周围区域都不是雷，还会接着触发。故我们可以尝试用递归方式去处理。具体实践中需要注意递归终止条件，避免出现递归死循环。

1. 翻开小格时，及时标记上“已翻”标记
2. 获取周围的小格时，排除掉这些有“已翻”标记的

## 后记

其实从上面的操作说明中可以看到，扫雷的鼠标交互还是挺丰富的。微软当年（1992 年）将扫雷内置在 windows 3.1
系统中发布，也希望用户通过扫雷来熟悉鼠标操作。

如今公众日常使用最广泛的人机交互应该算是触屏方式，但移动端的触屏并不能很好模拟完整的鼠标操作（比如右击和双击）。相比之前的
2048，扫雷并不适合在触屏上玩，这也是我在复刻游戏时的感想。

跨国公司有时会以游戏的方式来引导不同用户熟悉他们新提出的交互逻辑，比如本文中提到的扫雷（对应鼠标操作），2048（对应触屏滑动），以及当年 iPhone4 发布会上乔布斯曾用玩游戏的方式来演示过陀螺仪。而今年（2023 年）苹果公司新发布的 Vision Pro，是否又能给大众带来一套全新的交互体验呢？

## 参考链接

- [minesweeper.online](https://minesweeper.online/cn/)：一个在线的扫雷游戏平台，有介绍扫雷的具体规则和玩法技巧文档，也有记录世界各地玩家德扫雷成绩排行榜
- [扫雷 | wiki](<https://en.wikipedia.org/wiki/Minesweeper_(video_game)>)
